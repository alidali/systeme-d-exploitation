#include "header.h"

int main()
{
	DISK disk0; // mon disque
	int i,j,k;
	
	// formatage du disque (on met tous les inodes à 0 et bloc utilisés à -1) 
	for (i=0;i<INODE;i++) {
		disk0.inode[i].typefichier = 0;
		for (j=0;j<15;j++) disk0.inode[i].blocutilise[j]=-1;
	}
	
	// simulation d'un inode
	disk0.currentDirectory = "home";
	disk0.inode[0].typefichier=1;
	disk0.inode[0].parent = disk0.currentDirectory;
	disk0.inode[0].name = "fichier";
	disk0.inode[1].typefichier = 1;
	disk0.inode[1].name = "balbal";
	disk0.inode[2].typefichier = 2;
	disk0.inode[2].name = "Download";
	disk0.inode[0].blocutilise[0]=0;
	disk0.inode[0].blocutilise[1]=2;
	
	// simulation d'un fichier de 2048 octets dans les blocs 0 et 2
	for (i=0; i<1023; i++) disk0.bloc[0].donnees[i]='a';
	for (i=0; i<1023; i++) disk0.bloc[2].donnees[i]='b';
	
	/*
	// simulation de lecture d'un fichier à partir de son inode
	for (i=0; i<15; i++) {
	// on simule un cat du fichier
		if (disk0.inode[i].typefichier == 1) {// fichier texte
			for (j=0; j<15; j++)
				if (disk0.inode[i].blocutilise[j]!=-1) {
					for (k=0; k<1023; k++) printf("%c",disk0.bloc[disk0.inode[i].blocutilise[j]].donnees[k]);
				}
		}
	}*/
	
	char *buffer = NULL;
	char** pars = NULL;
	size_t	buf_size = 20;

	// alloc buffer qui stockera la commande entree par l'user
	buffer = (char *)calloc(sizeof(char), buf_size);
	if (buffer == NULL) {
		perror("Malloc failure");
		return (EXIT_FAILURE);
	}

	// ecriture d'un prompt
	//fprintf(stdout, "[Myshell] $ ", 12);		//fonctionne aussi
	printf (BLUE);
	fwrite("[Myshell] $ ", 1, sizeof("[Myshell] $"), stdout);
	printf(BLACK);
	
	// lecture de STDIN en boucle
	while (getline(&buffer, &buf_size, stdin) > 0) {
		pars = split(buffer, " \n\t");
		//no entry
		if( pars[0] == NULL ) {
		}	
		else if((strcmp(pars[0],"ls"))==0)
		{
			ls(disk0);
			//printf("cmd = %s\n", pars[0]);
		}
		else 
		{
			printf (RED);
			printf("%s : Commande introuvable\n", pars[0]);
		}
	printf (BLUE);
	fwrite("[Myshell] $ ", 1, sizeof("[Myshell] $"), stdout);
	printf (BLACK);
	
	}
	printf("Bye \n");
	free(buffer);
	
	return 0; 
}


